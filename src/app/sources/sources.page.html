<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>
      Sources
    </ion-title>
    <ion-buttons collapse="true" slot="end">
      <ion-button slot="end" (click)="openSuggestions()">
        <ion-icon color="medium" name="compass-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Sources</ion-title>
      <ion-buttons collapse="true" slot="end">
        <ion-button slot="end" (click)="openSuggestions()">
          <ion-icon color="medium" name="compass-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <form [formGroup]="rssForm">
    <ion-input
      [(ngModel)]="inputUrl"
      formControlName="url"
      type="url"
      placeholder="Please enter an RSS/Atom Feed URL"
      helperText="Enter a valid url"
      errorText="Invalid url"
      [clearOnEdit]="true"
    ></ion-input>
  </form>
  <ion-button ion-button (click)="discoverUrl(inputUrl)" [disabled]="!rssForm.valid">Search for Feed</ion-button>
  <ion-button ion-button (click)="addUrl(inputUrl)" [disabled]="!rssForm.valid">Add Feed</ion-button>

  <ion-list>
    <!-- The reorder gesture is disabled by default, enable it to drag and drop items -->
    <!-- Casting $event to $any is a temporary fix for this bug https://github.com/ionic-team/ionic-framework/issues/24245 -->
    <ion-reorder-group [disabled]="false" (ionItemReorder)="handleReorder($any($event))">
      @for (source of sourcesService.getSources(); track source.url) {
        <ion-reorder>
          <ion-item-sliding>
            <ion-item>
              <ion-label>
                <strong>{{source.title}}</strong>
                <br />
                <ion-text>{{source.url}}</ion-text>
                <br />
                <ion-note color="medium">{{source.description}}</ion-note>
              </ion-label>
              @if (source.healthy) {
                <ion-icon color="success" slot="end" name="checkmark-circle-outline"></ion-icon>
              }
              @else {
                <ion-icon color="danger" slot="end" name="close-circle-outline"></ion-icon>
              }
            </ion-item>
            <ion-item-options side="end">
              <ion-item-option color="secondary">
                <ion-icon slot="icon-only" name="create" (click)="editUrl(source)"></ion-icon>
              </ion-item-option>
              <ion-item-option color="danger">
                <ion-icon slot="icon-only" name="trash" (click)="sourcesService.removeSource(source.url)"></ion-icon>
              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </ion-reorder>
      }
    </ion-reorder-group>
  </ion-list>

  <!-- // Onboarding -->
  @if (sourcesService.getSources().length === 0) {
    <div class="ion-text-center" >
      It doesn't look like you have any sources yet, would you like to <a (click)="openSuggestions()">add some?</a>
    </div>
  }

</ion-content>
